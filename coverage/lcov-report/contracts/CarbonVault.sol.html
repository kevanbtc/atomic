<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/CarbonVault.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> CarbonVault.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/29</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/44</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/37</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/token/ERC20/extensions/ERC20Burnable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
import "@openzeppelin/contracts/utils/Pausable.sol";
&nbsp;
interface ICarbonOracle {
    function getCarbonPrice() external view returns (uint256);
    function verifyCarbonCredit(bytes32 creditId) external view returns (bool);
}
&nbsp;
contract CarbonVault is ERC20, ERC20Burnable, Ownable, ReentrancyGuard, Pausable {
    ICarbonOracle public carbonOracle;
    
    struct CarbonCredit {
        bytes32 creditId;
        address issuer;
        uint256 amount; // tonnes of CO2
        uint256 vintage; // year of credit generation
        string projectType;
        bool verified;
        bool retired;
    }
    
    mapping(bytes32 =&gt; CarbonCredit) public carbonCredits;
    mapping(address =&gt; bytes32[]) public userCredits;
    mapping(address =&gt; bool) public authorizedIssuers;
    
    uint256 public constant MIN_VINTAGE = 2020;
    uint256 public constant MAX_SUPPLY = 10000000 * 10**18; // 10M tonnes
    
    event CarbonCreditIssued(bytes32 indexed creditId, address indexed issuer, uint256 amount);
    event CarbonCreditRetired(bytes32 indexed creditId, address indexed retiree);
    event IssuerAuthorized(address indexed issuer);
    event IssuerRevoked(address indexed issuer);
    
<span class="fstat-no" title="function not covered" >    modifier onlyAuthorizedIssuer() {</span>
<span class="cstat-no" title="statement not covered" >        require(authorizedIssuers[msg.sender], "Not authorized issuer")</span>;
        _;
    }
    
<span class="fstat-no" title="function not covered" >    constructor(address _carbonOracle) ERC20("Carbon Credit Token", "CARBON") Ownable(msg.sender) {</span>
        carbonOracle = ICarbonOracle(_carbonOracle);
        authorizedIssuers[msg.sender] = true;
    }
    
<span class="fstat-no" title="function not covered" >    function authorizeIssuer(address _issuer) external onlyOwner {</span>
        authorizedIssuers[_issuer] = true;
<span class="cstat-no" title="statement not covered" >        emit IssuerAuthorized(_issuer);</span>
    }
    
<span class="fstat-no" title="function not covered" >    function revokeIssuer(address _issuer) external onlyOwner {</span>
        authorizedIssuers[_issuer] = false;
<span class="cstat-no" title="statement not covered" >        emit IssuerRevoked(_issuer);</span>
    }
    
<span class="fstat-no" title="function not covered" >    function issueCarbonCredit(</span>
        bytes32 _creditId,
        address _to,
        uint256 _amount,
        uint256 _vintage,
        string memory _projectType
    ) external onlyAuthorizedIssuer whenNotPaused {
<span class="cstat-no" title="statement not covered" >        require(carbonCredits[_creditId].creditId == bytes32(0), "Credit already exists")</span>;
<span class="cstat-no" title="statement not covered" >        require(_vintage &gt;= MIN_VINTAGE, "Vintage too old")</span>;
<span class="cstat-no" title="statement not covered" >        require(_vintage &lt;= (block.timestamp / (365 * 24 * 60 * 60)) + 1970, "Future vintage not allowed")</span>;
<span class="cstat-no" title="statement not covered" >        require(totalSupply() + _amount &lt;= MAX_SUPPLY, "Max supply exceeded")</span>;
        
<span class="cstat-no" title="statement not covered" >        bool verified = carbonOracle.verifyCarbonCredit(_creditId);</span>
<span class="cstat-no" title="statement not covered" >        require(verified, "Oracle verification failed")</span>;
        
        carbonCredits[_creditId] = CarbonCredit({
            creditId: _creditId,
            issuer: msg.sender,
            amount: _amount,
            vintage: _vintage,
            projectType: _projectType,
            verified: true,
            retired: false
        });
        
<span class="cstat-no" title="statement not covered" >        userCredits[_to].push(_creditId)</span>;
<span class="cstat-no" title="statement not covered" >        _mint(_to, _amount)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit CarbonCreditIssued(_creditId, msg.sender, _amount);</span>
    }
    
<span class="fstat-no" title="function not covered" >    function retireCarbonCredit(bytes32 _creditId) external nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        CarbonCredit storage credit = carbonCredits[_creditId];</span>
<span class="cstat-no" title="statement not covered" >        require(credit.creditId != bytes32(0), "Credit does not exist")</span>;
<span class="cstat-no" title="statement not covered" >        require(!credit.retired, "Credit already retired")</span>;
<span class="cstat-no" title="statement not covered" >        require(balanceOf(msg.sender) &gt;= credit.amount, "Insufficient balance")</span>;
        
        credit.retired = true;
<span class="cstat-no" title="statement not covered" >        _burn(msg.sender, credit.amount)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit CarbonCreditRetired(_creditId, msg.sender);</span>
    }
    
<span class="fstat-no" title="function not covered" >    function tradeCarbonCredit(bytes32 _creditId, address _to, uint256 _amount) external {</span>
<span class="cstat-no" title="statement not covered" >        CarbonCredit storage credit = carbonCredits[_creditId];</span>
<span class="cstat-no" title="statement not covered" >        require(credit.creditId != bytes32(0), "Credit does not exist")</span>;
<span class="cstat-no" title="statement not covered" >        require(!credit.retired, "Credit is retired")</span>;
<span class="cstat-no" title="statement not covered" >        require(_amount &lt;= credit.amount, "Amount exceeds credit")</span>;
<span class="cstat-no" title="statement not covered" >        require(balanceOf(msg.sender) &gt;= _amount, "Insufficient balance")</span>;
        
<span class="cstat-no" title="statement not covered" >        _transfer(msg.sender, _to, _amount)</span>;
    }
    
<span class="fstat-no" title="function not covered" >    function getCarbonCredit(bytes32 _creditId) external view returns (CarbonCredit memory) {</span>
<span class="cstat-no" title="statement not covered" >        return carbonCredits[_creditId];</span>
    }
    
<span class="fstat-no" title="function not covered" >    function getUserCredits(address _user) external view returns (bytes32[] memory) {</span>
<span class="cstat-no" title="statement not covered" >        return userCredits[_user];</span>
    }
    
<span class="fstat-no" title="function not covered" >    function setCarbonOracle(address _newOracle) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(_newOracle != address(0), "Invalid oracle address")</span>;
        carbonOracle = ICarbonOracle(_newOracle);
    }
    
<span class="fstat-no" title="function not covered" >    function pause() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _pause()</span>;
    }
    
<span class="fstat-no" title="function not covered" >    function unpause() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _unpause()</span>;
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Aug 24 2025 14:39:07 GMT-0400 (Eastern Daylight Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
